# План реализации Telegram бота с оптическими иллюзиями

## Обзор
Этот документ описывает план реализации Telegram бота, который генерирует изображения оптических иллюзий с двумя объектами и спрашивает у пользователей, какой из них больше. Бот будет интегрирован с AI сервисами для генерации промптов и изображений.

## Архитектура

### Компоненты
1. **Ядро Telegram бота** - Существующая реализация на C++ с использованием Boost.Beast
2. **Генератор AI промптов** - Интеграция с API aitunnel.ru для генерации промптов оптических иллюзий
3. **Генератор изображений** - Интеграция с API aitunnel.ru для генерации изображений оптических иллюзий
4. **Логика игры** - Реализация игрового процесса с оптическими иллюзиями

### Поток выполнения
1. Пользователь отправляет команду боту (например, `/illusion`)
2. Бот запрашивает у AI генерацию промпта оптической иллюзии с двумя объектами
3. Бот запрашивает у AI генерацию изображения на основе промпта
4. Бот отправляет изображение пользователю с тремя вариантами ответа: "Первый больше", "Второй больше", "Они равны"
5. Пользователь выбирает вариант
6. Бот предоставляет обратную связь о правильности ответа

## Этапы реализации

### 1. Интеграция с AI сервисами
#### Генерация промптов
- Конечная точка: `https://api.aitunnel.ru/v1/chat/completions`
- Модель: `deepseek-v3.2` (как указано в требованиях)
- Формат запроса аналогичен примеру `gpt.curl`
- Ответ должен включать промпт и правильный ответ

#### Генерация изображений
- Конечная точка: `https://api.aitunnel.ru/v1/images/generations`
- Модель: `gpt-image-1.5-low` (как указано в требованиях)
- Формат запроса аналогичен примеру `imsge.curl`
- Ответ должен включать изображение в формате base64

### 2. Расширение Telegram бота
#### Новые команды
- `/illusion` - Генерация нового задания с оптической иллюзией
- `/help` - Обновленная информация о командах

#### Обработка сообщений
- Добавить поддержку встроенных кнопок для ответов пользователя
- Добавить поддержку отправки изображений (декодированных из base64) пользователям

### 3. Реализация игровой логики
#### Управление состоянием
- Отслеживание сессий пользователей и текущих заданий
- Сохранение правильных ответов для проверки

#### Обработка ответов
- Проверка ответов пользователей с правильными ответами
- Предоставление обратной связи (правильно/неправильно)

## Структура файлов
```
src/
├── main.cpp
├── TelegramBot.h
├── TelegramBot.cpp
├── AIService.h
├── AIService.cpp
└── GameLogic.h
└── GameLogic.cpp
```

## Зависимости
- Boost.Beast (уже подключено)
- nlohmann/json (уже подключено)
- OpenSSL (уже подключено)

## Детали интеграции с API

### API генерации промптов
```
POST https://api.aitunnel.ru/v1/chat/completions
Заголовки:
  Content-Type: application/json
  Authorization: Bearer [API_KEY]
Тело:
  {
    "model": "deepseek-v3.2",
    "max_tokens": 500,
    "messages": [
      {
        "role": "user",
        "content": "Создай промпт для оптической иллюзии с двумя объектами, где один кажется больше другого, но на самом деле они одинакового размера. Ответь промптом для генерации изображения и правильным ответом (первый/второй/равны) в формате JSON."
      }
    ]
  }
```

### API генерации изображений
```
POST https://api.aitunnel.ru/v1/images/generations
Заголовки:
  Content-Type: application/json
  Authorization: Bearer [API_KEY]
Тело:
  {
    "model": "gpt-image-1.5-low",
    "prompt": "[ПРОМПТ_ИЗ_ВЕРХНЕГО_ЗАПРОСА]",
    "quality": "medium",
    "size": "1024x1024",
    "moderation": "low",
    "output_format": "png"
  }